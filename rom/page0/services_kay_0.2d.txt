services_kay v.0.2d
18:59 29.01.2015 Hard/WCG

+ В пункт меню HDD Boot добавил загрузку IS-DOS. Теперь перед считыванием
"возможного" загрузчика со 2го сектора производится проверка на наличие
загрузчика IS-DOS (сканируются 0е блоки треков 0-255 на наличие слова KAY
по смещению #7d, если оно имеется, то в этом блоке имеется описатель загрузчика системы).

services_kay v.0.2c+
23:06 12.10.2011 Hard/WCG
Мелкое исправление мелкого глюка - исправил автосохранение в EEPROM, раньше
не работала (tnx 2 ZEK).

services_kay v.0.2c
16:05 31.01.2011 Hard/WCG

+ Поправил "резидент" в ОЗУ для запуска Сервиса, CMOS SetUp,
  Клавиатурного теста и демы - теперь он и #1ffd обнуляет, а то были случаи
  когда запускался тест клавиатуры, а вместо букв - абракадабра...

+ Убрал при сбросе анализ нажатой кнопки CS (быстрый переход в Basic128), т.к.
  это приводило к зацикливанию. Эта же кнопка используется в Basic128 для
  быстрого перехода в ServiceROM.

* Исправил глюк в драйвере fe-eeprom, где при ошибке связи с контроллером
  не разрешались прерывания, что приводило к di:halt.

services_kay v.0.2b
16:05 31.01.2011 Hard/WCG

* Изменил детектирование часов, ранее GlukRTC определялись по чтению
  регистра секунд и если считалось #FF, то часы отсутствуют. В Кае на
  порт #XXF7 отзывается порт джойстика, поэтому при отсутствии GlukRTC
  из порта читается #00, и считается, что часы присутствуют. Покурив
  даташиты на Dallas и ВИ1, определил, что регистры A и B, при нормально
  идущих часах, не могут быть равны ни 0, ни #FF, в соответствии с этим
  изменил процедуру детектирования.

+ Добавил в код инициализации и распаковки НЕГлюк установку стека.

+ Прикрутил окошки с надписью "Processing..." в длительных операциях,
  как-то Reset pages, Image to RAMDISK.

+ В окне выбора файлов на FAT устройствах приделал вывод расширений
  файлов.

services_kay v.0.2a
15:48 29.01.2011 Hard/WCG

* обнаружил глюк - неглюк не хочет отображать каталог виртуального
  диска Kay, выдает ошибку "Stupid user". Исправил - перед обращением
  к диску даем команду инициализации.

+ Теперь KAY Service Rom умеет грузить в рам-диск файлы trd.
  Прикрутил новый fat_boot от ЭвоСервис-рома, но вырезал из него
  загрузку fdi-образов. Правда пришлось передвинуть буфер каталога из
  страничной области, с адреса #c000 на адрес #A500, ну не умеет
  Кай, как Эво щелкать страницами в окнах CPU1-CPU2. А это по идее при
  большом количестве файлов в каталоге может привести к краху.

* Переделал процедуру загрузки scl-файлов. Однако стоит учитывать, что
  при превышении scl-а 640 кб, часть файла обрежется, т.к. память-то
  не резиновая, это вам не ПентЭво :) Это же касается и trd нестандартной
  длины.

* Исправил глюк с опросом мыши, приводящий к зависаниям, при
  отсутствии контроллера мыши. Tnx 2 Лас.

services_kay v.0.1d
13:21 28.01.2011 Hard/WCG

+ добавил драйвер eeprom, теперь при наличии контроллера PS/2
  клавиатуры Caro, можно использовать внутреннюю память МК как
  энергонезависимую, т.е. хранить в ней настройки HEGLUK.
  При инициализации глюка, производится детект GlukRTC, и eeprom
  на порту hFE, приоритет у GlukRTC больший.

* Переделал работу драйвера rtc/eeprom, в виду определенного числа
  циклов перезаписи eeprom, при работе с eeprom в памяти
  организовывается буфер в 256 байт, в котором производятся текущие
  манипуляции (чтение/запись), по команде пользователя (кн.E), либо
  при запуске какой-нить программы (если включен Autosave SetUP) -
  изменения буфера записываются в eeprom. Работа с RTC ведется в
  прежнем режиме, т.е. изменения записываются сразу.

+ Добавлен пункт Autosave SetUP, который отвечает за автосохранение
  настроек глюка в eeprom при запуске какой-нить программы. Настройка
  хранится в eeprom/rtc в 18м байте, бит 0.

* Пересмотрел горячие кнопки, теперь E - сохранение настроек в eeprom,
  S (с капсом) - режим автосохранения настроек вкл/выкл, Y - выбор
  буквы вирт. диска.

services_kay v.0.1c
10:11 27.01.2011 Hard/WCG

* Переделал киллер памяти под KAY-евскую память.

* Исправил горячую кнопку на киллер памяти 128К, т.к. в
  оригинале использовалась кнопка "P", которая является глобальной
  хот-кеей и в меню Kills не срабатывала.

* Чуть переделал вид основного экрана, приблизил к последним
  эвосервис-ромам.

+ Добавил вызов страницы помощи по горячим кнопкам, как в последнем
  эво-сервисроме.

* Вместе с Alex_Nemo нарисовали логотип для KAY 1024 Service ROM,
  заменил Пентэвовский логотип на Каевский.

* Вернул и допилил блокировку памяти >128Кб. Управляется через
  бит D1 порта #1FFD, как и в P1024.

- Убрал в меню Services пункт Copy disk, как недоделанное и приводящее
  к висякам.

- Убрал из распаковщика среды Неглюка работу с портом 1FFD,
  т.к. при определенных обстоятельствах это может привести к глюкам.

services_kay v.0.1b
8:25 26.01.2011 Hard/WCG

* Исправлены глюки с выпадением в бейсик, при отсутствии часов.

* Управление турбой через #1ffd.

- Убрана опция MemoryLock 128, т.к. в кае невозможно залочить
  верхнюю память.


12:49 25.01.2011 Hard/WCG
services_kay v.0.1

~ постепенная работа по переводу НЕГлюка на кай-совместимые машины.

* Переделана процедура создания рам-диска. Теперь создается рам-диск,
  в формате TR-DOS 5.04T D:9901, родная для каев. Рам-диск создается
  по умолчанию на диске C:, однако со временем, если вкурю работу с
  окнами в неглюке, постараюсь возможность выбора.

- Убраны 2 пункта меню Kills, которые создают рам-диски более 640Кб,
  для кая с родной версией тр-дос бесполезны.

+ Сделан выбор буквы для рам-диска, но он глобально меняется только
  после создания рам-диска. Кроме того есть нюанс, номер действителен
  только до перезагрузки тр-дос, тогда она инициализирует свои
  переменные заново и рам-диском становится диск С:. Посмотрю куда
  сохраняет Савелий данные о виртуальном диске в кмосе, возможно и
  я так сделаю :)

! Пока куча глюков и зависонов при выборе турборежимов, однако рулилка
  доппамятью памятью уже учитывает флаг турбы.